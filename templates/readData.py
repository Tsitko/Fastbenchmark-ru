# The code was generated by FastBenchmark telegram bot


import pandas as pd
from sklearn.model_selection import train_test_split
import numpy as np
import xgboost as xgb
from datetime import datetime
from sklearn.metrics import mean_squared_error
from sklearn.metrics import classification_report
from sklearn.metrics import mean_squared_log_error
import matplotlib.pyplot as plt
import warnings
import seaborn as sns
from sklearn.metrics import roc_auc_score
from sklearn.preprocessing import LabelEncoder
from sklearn.preprocessing import LabelBinarizer
from sklearn.metrics import mean_absolute_error
import itertools
import json
import os
import pickle


warnings.simplefilter(action='ignore')
pd.options.mode.chained_assignment = None

# which correlation is good enough?
correlation_level = 0.7

# list of errors
errors = []
# list of columns to delete
to_drop = []

# coefficient to make plots for categories (if more categories - will not plot it)
cat_coef = 10

# reading the data
data = pd.read_csv(%data_path%, sep = %separator%)

# dealing with wrong csv formats
unnamed = []
for i in range(len(data.columns)):
    if data.columns[i][:9] == 'Unnamed__':
        unnamed.append(data.columns[i])
for name in unnamed:
    data = data.drop(name, axis=1)

# numeric columns
numeric_cols = []

# cheking if target column is in columns
target_col_name = %target_column_name%

# how much points to draw to visualize correlations
sequence_length = round(min(1000, data.shape[0]/2))

if target_col_name not in data.columns:
    print('No ' + str(target_col_name) + ' in test set')
    errors.append('No ' + str(target_col_name) + ' in test set')
    to_drop.append(target_col_name)
    quit()

if str(target_col_name) + '_encode.log' in os.listdir():
    os.remove(str(target_col_name) + '_encode.log')

# coefficient to check if categories are rare enough
cat_check = 0.01*len(data[target_col_name])

# make train and test
train, test = train_test_split(data, test_size=0.2, random_state=1)

# remove rows were target is Na
train = train[train[target_col_name].notna()]
if target_col_name in test.columns:
    test = test[test[target_col_name].notna()]
